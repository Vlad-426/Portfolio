# Как разработать испытательное оборудование для печатной платы

Когда идет речь о разработке печатных плат мало внимания уделяется разработке испытательной оснастки. Но если ожидается значительный объем продукции или же ручная проверка будет трудоемкой я предпочитаю разработать испытательную оснастку для Test Jig.
Но что такое Test Jig? Это электромеханическое устройство, позволяющее оценить функционал печатной платы требованиям проектной документации. Особое значение это имеет, когда продукция производится для стороннего пользователя, на продажу. Проверка будет занимать значительное количество времени, особенно если плата содержит большое количество компонентов. Если на проверку одной платы тратиться порядка 20 минут, проверка партии из 1000 таких плат доставит немало трудностей в связи с возникающими проблемами по затратам и ответственности. Однако хорошо спроектированный испытательный стенд в разы сокращает время, испытаний по сравнению проверкой вручную.
Существуют различные варианты Test Jig, от недорогих стендов с Алиэкспресса, которые надо дорабатывать вручную под свои задачи, до высокотехнологичных автоматизированных решений. Однако разработка эффективной тестовой оснастки - сложная задача, требующая знаний в нескольких дисциплинах. Для разработки испытательного оборудования необходимо спроектировать плату для установки щупов с плавающими контактами (пинов), составить код для микроконтроллера и разработать механическую составляющую стенда.

***

## Изготовление Test jig

Здесь не будет универсального решения по разработке TestJig, но мой опыт может помочь вам сэкономить затраты.


![Building a test jig](https://cdn.shopify.com/s/files/1/0775/5913/6604/files/PAROL6_jig_480x480.png?v=1708444308)


Вот пример оснастки на основе роботизированного манипулятора и платы управления [PAROL6](https://source-robotics.com/products/parol6-control-board).
Как вы можете видеть, к изготовлению первого образца стенда можно подойти творчески, чтобы понять, какое решение работает, а какое нет. Используйте 3D принтер, фанеру, любые подручные материалы для проверки конструктивных решений. Потом можно создать более серьезную конструкцию.
В качестве примера приведу примеры наших стендов на основе [роботизорованного манипулятора и платы управления PAROL6](https://source-robotics.com/products/parol6-control-board) и Test Jig для [контроллера двигателя Spectral BLDC](https://source-robotics.com/products/spectral-micro-bldc-controller).

***

## Каким должен быть испытательный стенд?

- Плата для установки пинов – обычно разрабатывается тем же человеком, который разрабатывал саму печатную плату. Эта плата будет полностью идентичная тестируемой, но вместо контрольных точек будут спроектированы отверстия для установки пинов. Плата для установки пинов используется для обеспечения электрического контакта с контрольными точками на PCB, которые необходимо проверить. Существует множество типов пинов, но обычно используется только три: с острым или корончатым наконечником для площадок и с плоским - для сквозных отверстий.

- ![Варианты пинов](https://cdn.shopify.com/s/files/1/0775/5913/6604/files/pogo_pins_480x480.png?v=1708444912)

- Прижимной механизм – Прижимной механизм необходим чтобы прижать печатную плату, для обеспечения надежного контакта между контактными площадками и пинами.  

- ![Прижимной механизм](https://cdn.shopify.com/s/files/1/0775/5913/6604/files/Clamp_480x480.png?v=1708445092)

- Корпус испытательного стенда – его можно разработать самостоятельно, купить на aliexpress или рассмотреть другие готовые решения.
  Самый оптимальный вариант – разработать самостоятельно, так вы можете учесть все свои потребности и оптимизировать под все свои задачи, но для этого необходимы навыки проектирования в CAD.
  Корпус стенда дает общую конструкцию, в нем могут располагаться необходимые технологические жгуты и функциональные элементы

- Компьютер или микроконтроллер, на котором будет установлена проверяющая программа.

- Устройства связи или интерфейса (например, адаптеры USB серии, CAN ) на вашем ПК обычно нет шины CAN или UART  , поэтому вам понадобится либо адаптер для этого, либо Raspberry Pi, на GPIO  которого реализованы некоторые из этих функций.

- Программные адаптеры (например STlinks)

- Дисплей — не обязателен, но полезен для упрощения процесса отладки и регистрации. Если тест сложный, рекомендуется иметь дисплей для пользовательского интерфейса или для печати журналов испытаний.

- Принтер — не обязателен, но пригодится если есть необходимость печатать отчеты об испытаниях.

- Пользовательский интерфейс (кнопки или другие органы управления, клавиатура, мышь и т. д.).
  
  ***

## Размещение контрольных точек на тестируемой печатной плате

Нередко бывает, что проектировщики устанавливают контрольные точки без тщательной проработки. Для эффективного испытания печатной платы необходимо провести анализ на основе потенциального отказа и необходимых функций, которые необходимо протестировать. Например, использование контрольной точки для проверки работоспособности светодиода не целесообразно, так как светодиоды имеют низкую точку отказа. Гораздо важнее проверить падение напряжения, которое будет иметь решающее значение для многих других функций, чем тестировать один светодиод. Используйте простые тесты, например прохождение сигнала по цепи для принятия решения о работоспособности платы и целостности электрических цепей.


![PCB](https://cdn.shopify.com/s/files/1/0775/5913/6604/files/test_points_480x480.jpg?v=1708447891)


Размещение контрольных точек:

- Контрольные точки должны располагаться на расстоянии не менее 2 мм друг от друга
- Контрольные точки должны располагаться на одной стороне печатной платы
- Контрольные точки должны быть диаметром не менее 1 мм (мы обычно используем 2,5 мм)
- Не размещайте все контрольные точки в одной части платы.

***

## Прошивка

В современных условиях печатные платы, содержащие в себе процессоры, прошивается непосредственно на заводе. Традиционная практика независимого программирования микроконтоллеров и последующего их монтажа на печатную плату стала менее распространена. Поэтому важно учесть простой вариант подключения к печатной плате, который был бы одновременно удобен для пользователя и не вызвал бы проблем с интеграцией его в испытательный стенд. В нашем случае предлагается два решения: одно с контрольными точками, для прошивки при помощи пинов, а второе - для подключения вручную, с использованием небольших отверстий для штыревых разъемов

***

## Какую прошивку загружать?

Прошивка для проверки существует двух видов. Один из них включает в себя загрузку прошивки, специально разработанной для тестирования; если плата проходит все тесты, то загружается рабочая прошивка. Альтернативой является включение тестовых процедур для испытательного стенда непосредственно в рабочую прошивку. Второй тип имеет два явных преимущества. Во-первых, он гарантирует, что ни одна плата не покинет стенд с неправильно загруженной прошивкой, что является дополнительной защитой от ошибок при загрузке. Во-вторых, такой тип проверки способствует полной проверке как платы, так и прошивки. Функционал наших стендов, также может использоваться для ремонтных целей. Связь между печатной платой  и стендом может осуществляться через JTAG , UART или CAN (в зависимости от того, с чем вы работатете)
Прошивка для проверки существует двух видов. Один из них включает в себя загрузку прошивки, специально разработанной для тестирования; если плата проходит все тесты, то загружается рабочая прошивка. Альтернативой является включение тестовых процедур для испытательного стенда непосредственно в рабочую прошивку. Второй тип имеет два явных преимущества. Во-первых, он гарантирует, что ни одна плата не покинет стенд с неправильно загруженной прошивкой, что является дополнительной защитой от ошибок при загрузке. Во-вторых, такой тип проверки способствует полной проверке как платы, так и прошивки. Функционал наших стендов, также может использоваться для ремонтных целей. Связь между печатной платой  и стендом может осуществляться через JTAG , UART или CAN (в зависимости от того, с чем вы работаете)

***

## Виды проверок

Существует несколько видов проверок. Обычно используется проверка функционирования печатной платы или же производят более подробную проверку путём дополнительного измерения падения напряжения, сопротивления цепей и т. д.
Давайте рассмотрим на конкретном примере. Сначала устанавливаем прошивку. Мы используем JTAG. Для проверки возьмем контроллер двигателя [Spectral BLDC](https://source-robotics.com/products/spectral-micro-bldc-controller) который используется для управления двигателями BLDC роботизированных приводов. Что здесь самое важное? Нам нужно провести проверку алгоритмов FOC  при которых необходимо измерять фазный ток и угол поворота ротора. Нам также необходимо протестировать коммуникационные интерфейсы CAN и UART. Для проверки функциональности FOC создадим управление фазами двигателя на испытательном стенде платой с пинами. Кроме этого, вал двигателя проходит через плату с пинами, на нижней стороне платы установлен магнитный датчик, который определяет угол поворота вала. Такое размещение позволяет протестировать FOC. Используя коммуникацию, основанную на CAN и UART мы можем проверить другие функции, такие как ERPOM , измерение VBUS  и т. д. На печатной плате эти измерения производятся косвенным методом, данные выводятся с помощью UART, таким образом нет необходимости устанавливать большое количество контрольных точек для проверки каждой функции.


![](https://cdn.shopify.com/s/files/1/0775/5913/6604/files/spectral_jig_480x480.png?v=1708445261)


Следующий пример сложнее. Эта печатная плата используется как материнская плата для роботизированного манипулятора, приводящая в действие шесть шаговых двигателей и управляющая шестью датчиками предельных значений, цифровыми входами/выхода, CAN, UART, флэш-памятью, питанием и аварийной остановкой. Используется в [роботизированном манипуляторе PAROL6](https://source-robotics.com/products/parol6-control-board).


![](https://cdn.shopify.com/s/files/1/0775/5913/6604/files/PAROL6_jig_480x480.png?v=1708444308)


В данном случае проверку можно реализовать двумя способами. В первом, как в предыдущем случае, можно автоматически определять вращение двигателей, управлять датчиками предельных значений и цифровыми входами с помощью полевых транзисторов и измерять уровни напряжений на цифровых выходах для регистрации включения. Однако это повлекло бы за собой дополнительное увеличение сложности платы, что неоправданно при ее и без того сложном функционале. Второй способ — это проверка вручную, где двигатели подключаются через контрольные точки на печатной плате и проверка их включения производится визуально. Предельные значения проверяются переключением вручную, а сигналы на выходе отображаются с помощью светодиодов. Вся информация передается через UART и CAN подтверждая данные проверок. Данный способ также позволяет проверить проверку напряжений на печатной плате, работу FLASH-памяти и корректность связи SPI  с каждым приводом двигателя
